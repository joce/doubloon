[tox]
envlist = py{310,311,312,313,314}
isolated_build = true
skip_missing_interpreters = true

[gh-actions]
python =
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313
    3.14: py314

[testenv]
description = Run tests and checks for Python {envname}
allowlist_externals = uv
skip_install = true
setenv =
    UV_CACHE_DIR = {toxinidir}/.uv-cache
    VIRTUAL_ENV = {toxinidir}/.venv
    VIRTUALENV_HOME = {toxinidir}/.virtualenv
    VIRTUALENV_APP_DATA = {toxinidir}/.virtualenv-app-data
    py310: PYRIGHT_PYTHON_VERSION = 3.10
    py311: PYRIGHT_PYTHON_VERSION = 3.11
    py312: PYRIGHT_PYTHON_VERSION = 3.12
    py313: PYRIGHT_PYTHON_VERSION = 3.13
    py314: PYRIGHT_PYTHON_VERSION = 3.14
commands_pre =
    uv sync --group tox --frozen
commands =
    # Format validation with Ruff
    uv run ruff format --check --quiet --diff --target-version py310 .
    # Linting with Ruff
    uv run ruff check --target-version py310 .
    # Checking imports with isort
    uv run isort -c --profile black --python-version auto .
    # Checking formatting with black
    uv run black --check .
    # Analyzing the code with pylint
    uv run pylint -j 1 src tests
    # Analyzing typing with pyright
    uv run pyright --pythonversion {env:PYRIGHT_PYTHON_VERSION}
    # Run pytest
    uv run pytest

# Quick check environment - runs checks only once on your current Python version
[testenv:check]
description = Run all checks once on current Python version
commands =
    uv run ruff format --check --quiet --diff --target-version py310 .
    uv run ruff check --target-version py310 .
    uv run isort -c --profile black --python-version auto .
    uv run black --check .
    uv run pylint -j 1 src tests
    uv run pyright
    uv run pytest

# Fast test environment - only runs tests, no linting
[testenv:test]
description = Run only tests across all Python versions
envlist = py{310,311,312,313,314}
commands =
    uv run pytest
