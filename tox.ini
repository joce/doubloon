[tox]
envlist = py{3.10,3.11,3.12,3.13,3.14}
isolated_build = true
skip_missing_interpreters = true
requires = tox-uv >= 1.29

[gh-actions]
python =
    3.10: py3.10
    3.11: py3.11
    3.12: py3.12
    3.13: py3.13
    3.14: py3.14

[testenv]
description = Run tests and checks for Python {envname}
runner = uv-venv-lock-runner
dependency_groups =
    dev
no_default_groups = false
setenv =
    py3.10: PYRIGHT_PYTHON_VERSION = 3.10
    py3.11: PYRIGHT_PYTHON_VERSION = 3.11
    py3.12: PYRIGHT_PYTHON_VERSION = 3.12
    py3.13: PYRIGHT_PYTHON_VERSION = 3.13
    py3.14: PYRIGHT_PYTHON_VERSION = 3.14
commands =
    # Format validation with Ruff
    ruff format --check --quiet --diff --target-version py310 .
    # Linting with Ruff
    ruff check --target-version py310 .
    # Checking imports with isort
    isort -c --profile black --python-version auto .
    # Checking formatting with black
    black --check .
    # Analyzing the code with pylint
    pylint -j 0 src tests
    # Analyzing typing with pyright
    pyright --pythonversion {env:PYRIGHT_PYTHON_VERSION}
    # Run pytest
    pytest

# Quick check environment - runs checks only once on your current Python version
[testenv:check]
description = Run all checks once on current Python version
commands =
    ruff format --check --quiet --diff --target-version py310 .
    ruff check --target-version py310 .
    isort -c --profile black --python-version auto .
    black --check .
    pylint -j 0 src tests
    pyright
    pytest

# Fast test environment - only runs tests, no linting
[testenv:test]
description = Run only tests across all Python versions
envlist = py{3.10,3.11,3.12,3.13,3.14}
commands =
    pytest

[testenv:coverage]
description = Run pytest with coverage reporting
basepython = python3.14
dependency_groups =
    dev
setenv =
    COVERAGE_MINIMUM = 95
commands =
    pytest \
        --ignore-glob=**/integration/** \
        --cov=src \
        --cov-report=xml:coverage.xml \
        --cov-report=term-missing \
        --cov-fail-under={env:COVERAGE_MINIMUM} \
        --junitxml=junit.xml -o junit_family=legacy \
        {posargs}
